<?php
/**
 * Generated by Haxe 4.1.5
 */

namespace haxe\format;

use \php\_Boot\HxAnon;
use \php\Boot;
use \haxe\Exception;

class JsonParser {
	/**
	 * @var int
	 */
	public $pos;
	/**
	 * @var mixed
	 */
	public $str;

	/**
	 * @param mixed $buf
	 * @param mixed $s
	 * @param int $pos
	 * @param int $length
	 * 
	 * @return mixed
	 */
	public static function addSub ($buf, $s, $pos, $length) {
		return ($buf . \substr($s, $pos, $length));
	}

	/**
	 * @param mixed $s
	 * @param int $pos
	 * 
	 * @return int
	 */
	public static function fastCodeAt ($s, $pos) {
		if ($pos >= \strlen($s)) {
			return 0;
		} else {
			return \ord($s[$pos]);
		}
	}

	/**
	 * @param string $str
	 * 
	 * @return mixed
	 */
	public static function parse ($str) {
		return (new JsonParser($str))->doParse();
	}

	/**
	 * @param mixed $s
	 * @param int $pos
	 * @param int $length
	 * 
	 * @return mixed
	 */
	public static function substr ($s, $pos, $length = null) {
		return \substr($s, $pos, $length);
	}

	/**
	 * @param string $str
	 * 
	 * @return void
	 */
	public function __construct ($str) {
		$this->str = $str;
		$this->pos = 0;
	}

	/**
	 * @return mixed
	 */
	public function doParse () {
		$result = $this->parseRec();
		$c = null;
		while (true) {
			$s = $this->str;
			$pos = $this->pos++;
			$c = ($pos >= \strlen($s) ? 0 : \ord($s[$pos]));
			if (!($c !== 0)) {
				break;
			}
			if ($c === 9 || $c === 10 || $c === 13 || $c === 32) {
			} else {
				$this->invalidChar();
			}
		}
		return $result;
	}

	/**
	 * @return void
	 */
	public function invalidChar () {
		$this->pos--;
		$s = $this->str;
		$pos = $this->pos;
		throw Exception::thrown("Invalid char " . ((($pos >= \strlen($s) ? 0 : \ord($s[$pos])))??'null') . " at position " . ($this->pos??'null'));
	}

	/**
	 * @param int $start
	 * 
	 * @return void
	 */
	public function invalidNumber ($start) {
		throw Exception::thrown("Invalid number at position " . ($start??'null') . ": " . (\substr($this->str, $start, $this->pos - $start)??'null'));
	}

	/**
	 * @return int
	 */
	public function nextChar () {
		$s = $this->str;
		$pos = $this->pos++;
		if ($pos >= \strlen($s)) {
			return 0;
		} else {
			return \ord($s[$pos]);
		}
	}

	/**
	 * @param int $c
	 * 
	 * @return mixed
	 */
	public function parseNumber ($c) {
		$start = $this->pos - 1;
		$minus = $c === 45;
		$digit = !$minus;
		$zero = $c === 48;
		$point = false;
		$e = false;
		$pm = false;
		$end = false;
		while (true) {
			$s = $this->str;
			$pos = $this->pos++;
			$c = ($pos >= \strlen($s) ? 0 : \ord($s[$pos]));
			if ($c === 43 || $c === 45) {
				if (!$e || $pm) {
					$this->invalidNumber($start);
				}
				$digit = false;
				$pm = true;
			} else if ($c === 46) {
				if ($minus || $point || $e) {
					$this->invalidNumber($start);
				}
				$digit = false;
				$point = true;
			} else if ($c === 48) {
				if ($zero && !$point) {
					$this->invalidNumber($start);
				}
				if ($minus) {
					$minus = false;
					$zero = true;
				}
				$digit = true;
			} else if ($c === 49 || $c === 50 || $c === 51 || $c === 52 || $c === 53 || $c === 54 || $c === 55 || $c === 56 || $c === 57) {
				if ($zero && !$point) {
					$this->invalidNumber($start);
				}
				if ($minus) {
					$minus = false;
				}
				$digit = true;
				$zero = false;
			} else if ($c === 69 || $c === 101) {
				if ($minus || $zero || $e) {
					$this->invalidNumber($start);
				}
				$digit = false;
				$e = true;
			} else {
				if (!$digit) {
					$this->invalidNumber($start);
				}
				$this->pos--;
				$end = true;
			}
			if ($end) {
				break;
			}
		}
		$f = \Std::parseFloat(\substr($this->str, $start, $this->pos - $start));
		$i = (int)($f);
		if (Boot::equal($i, $f)) {
			return $i;
		} else {
			return $f;
		}
	}

	/**
	 * @return mixed
	 */
	public function parseRec () {
		while (true) {
			$s = $this->str;
			$pos = $this->pos++;
			$c = ($pos >= \strlen($s) ? 0 : \ord($s[$pos]));
			if ($c === 9 || $c === 10 || $c === 13 || $c === 32) {
			} else if ($c === 34) {
				return $this->parseString();
			} else if ($c === 45 || $c === 48 || $c === 49 || $c === 50 || $c === 51 || $c === 52 || $c === 53 || $c === 54 || $c === 55 || $c === 56 || $c === 57) {
				$c1 = $c;
				$start = $this->pos - 1;
				$minus = $c1 === 45;
				$digit = !$minus;
				$zero = $c1 === 48;
				$point = false;
				$e = false;
				$pm = false;
				$end = false;
				while (true) {
					$s1 = $this->str;
					$pos1 = $this->pos++;
					$c1 = ($pos1 >= \strlen($s1) ? 0 : \ord($s1[$pos1]));
					if ($c1 === 43 || $c1 === 45) {
						if (!$e || $pm) {
							$this->invalidNumber($start);
						}
						$digit = false;
						$pm = true;
					} else if ($c1 === 46) {
						if ($minus || $point || $e) {
							$this->invalidNumber($start);
						}
						$digit = false;
						$point = true;
					} else if ($c1 === 48) {
						if ($zero && !$point) {
							$this->invalidNumber($start);
						}
						if ($minus) {
							$minus = false;
							$zero = true;
						}
						$digit = true;
					} else if ($c1 === 49 || $c1 === 50 || $c1 === 51 || $c1 === 52 || $c1 === 53 || $c1 === 54 || $c1 === 55 || $c1 === 56 || $c1 === 57) {
						if ($zero && !$point) {
							$this->invalidNumber($start);
						}
						if ($minus) {
							$minus = false;
						}
						$digit = true;
						$zero = false;
					} else if ($c1 === 69 || $c1 === 101) {
						if ($minus || $zero || $e) {
							$this->invalidNumber($start);
						}
						$digit = false;
						$e = true;
					} else {
						if (!$digit) {
							$this->invalidNumber($start);
						}
						$this->pos--;
						$end = true;
					}
					if ($end) {
						break;
					}
				}
				$f = \Std::parseFloat(\substr($this->str, $start, $this->pos - $start));
				$i = (int)($f);
				if (Boot::equal($i, $f)) {
					return $i;
				} else {
					return $f;
				}
			} else if ($c === 91) {
				$arr = new \Array_hx();
				$comma = null;
				while (true) {
					$s2 = $this->str;
					$pos2 = $this->pos++;
					$__hx__switch = (($pos2 >= \strlen($s2) ? 0 : \ord($s2[$pos2])));
					if ($__hx__switch === 9 || $__hx__switch === 10 || $__hx__switch === 13 || $__hx__switch === 32) {
					} else if ($__hx__switch === 44) {
						if ($comma) {
							$comma = false;
						} else {
							$this->invalidChar();
						}
					} else if ($__hx__switch === 93) {
						if ($comma === false) {
							$this->invalidChar();
						}
						return $arr;
					} else {
						if ($comma) {
							$this->invalidChar();
						}
						$this->pos--;
						$x = $this->parseRec();
						$arr->arr[$arr->length++] = $x;
						$comma = true;
					}
				}
			} else if ($c === 102) {
				$save = $this->pos;
				$tmp = null;
				$tmp1 = null;
				$tmp2 = null;
				$s3 = $this->str;
				$pos3 = $this->pos++;
				if ((($pos3 >= \strlen($s3) ? 0 : \ord($s3[$pos3]))) === 97) {
					$s4 = $this->str;
					$pos4 = $this->pos++;
					$tmp2 = (($pos4 >= \strlen($s4) ? 0 : \ord($s4[$pos4]))) !== 108;
				} else {
					$tmp2 = true;
				}
				if (!$tmp2) {
					$s5 = $this->str;
					$pos5 = $this->pos++;
					$tmp1 = (($pos5 >= \strlen($s5) ? 0 : \ord($s5[$pos5]))) !== 115;
				} else {
					$tmp1 = true;
				}
				if (!$tmp1) {
					$s6 = $this->str;
					$pos6 = $this->pos++;
					$tmp = (($pos6 >= \strlen($s6) ? 0 : \ord($s6[$pos6]))) !== 101;
				} else {
					$tmp = true;
				}
				if ($tmp) {
					$this->pos = $save;
					$this->invalidChar();
				}
				return false;
			} else if ($c === 110) {
				$save1 = $this->pos;
				$tmp3 = null;
				$tmp4 = null;
				$s7 = $this->str;
				$pos7 = $this->pos++;
				if ((($pos7 >= \strlen($s7) ? 0 : \ord($s7[$pos7]))) === 117) {
					$s8 = $this->str;
					$pos8 = $this->pos++;
					$tmp4 = (($pos8 >= \strlen($s8) ? 0 : \ord($s8[$pos8]))) !== 108;
				} else {
					$tmp4 = true;
				}
				if (!$tmp4) {
					$s9 = $this->str;
					$pos9 = $this->pos++;
					$tmp3 = (($pos9 >= \strlen($s9) ? 0 : \ord($s9[$pos9]))) !== 108;
				} else {
					$tmp3 = true;
				}
				if ($tmp3) {
					$this->pos = $save1;
					$this->invalidChar();
				}
				return null;
			} else if ($c === 116) {
				$save2 = $this->pos;
				$tmp5 = null;
				$tmp6 = null;
				$s10 = $this->str;
				$pos10 = $this->pos++;
				if ((($pos10 >= \strlen($s10) ? 0 : \ord($s10[$pos10]))) === 114) {
					$s11 = $this->str;
					$pos11 = $this->pos++;
					$tmp6 = (($pos11 >= \strlen($s11) ? 0 : \ord($s11[$pos11]))) !== 117;
				} else {
					$tmp6 = true;
				}
				if (!$tmp6) {
					$s12 = $this->str;
					$pos12 = $this->pos++;
					$tmp5 = (($pos12 >= \strlen($s12) ? 0 : \ord($s12[$pos12]))) !== 101;
				} else {
					$tmp5 = true;
				}
				if ($tmp5) {
					$this->pos = $save2;
					$this->invalidChar();
				}
				return true;
			} else if ($c === 123) {
				$obj = new HxAnon();
				$field = null;
				$comma1 = null;
				while (true) {
					$s13 = $this->str;
					$pos13 = $this->pos++;
					$__hx__switch = (($pos13 >= \strlen($s13) ? 0 : \ord($s13[$pos13])));
					if ($__hx__switch === 9 || $__hx__switch === 10 || $__hx__switch === 13 || $__hx__switch === 32) {
					} else if ($__hx__switch === 34) {
						if (($field !== null) || $comma1) {
							$this->invalidChar();
						}
						$field = $this->parseString();
					} else if ($__hx__switch === 44) {
						if ($comma1) {
							$comma1 = false;
						} else {
							$this->invalidChar();
						}
					} else if ($__hx__switch === 58) {
						if ($field === null) {
							$this->invalidChar();
						}
						\Reflect::setField($obj, $field, $this->parseRec());
						$field = null;
						$comma1 = true;
					} else if ($__hx__switch === 125) {
						if (($field !== null) || ($comma1 === false)) {
							$this->invalidChar();
						}
						return $obj;
					} else {
						$this->invalidChar();
					}
				}
			} else {
				$this->invalidChar();
			}
		}
	}

	/**
	 * @return mixed
	 */
	public function parseString () {
		$start = $this->pos;
		$buf = null;
		while (true) {
			$s = $this->str;
			$pos = $this->pos++;
			$c = ($pos >= \strlen($s) ? 0 : \ord($s[$pos]));
			if ($c === 34) {
				break;
			}
			if ($c === 92) {
				if ($buf === null) {
					$buf = "";
				}
				$buf = ($buf . \substr($this->str, $start, $this->pos - $start - 1));
				$s1 = $this->str;
				$pos1 = $this->pos++;
				$c = ($pos1 >= \strlen($s1) ? 0 : \ord($s1[$pos1]));
				if ($c === 34 || $c === 47 || $c === 92) {
					$buf = ($buf . \mb_chr($c));
				} else if ($c === 98) {
					$buf = ($buf . \chr(8));
				} else if ($c === 102) {
					$buf = ($buf . \chr(12));
				} else if ($c === 110) {
					$buf = ($buf . "\x0A");
				} else if ($c === 114) {
					$buf = ($buf . "\x0D");
				} else if ($c === 116) {
					$buf = ($buf . "\x09");
				} else if ($c === 117) {
					$uc = \Std::parseInt("0x" . (\substr($this->str, $this->pos, 4)??'null'));
					$this->pos += 4;
					$buf = ($buf . \mb_chr($uc));
				} else {
					throw Exception::thrown("Invalid escape sequence \\" . (\mb_chr($c)??'null') . " at position " . ($this->pos - 1));
				}
				$start = $this->pos;
			} else if ($c >= 128) {
				$this->pos++;
				if ($c >= 252) {
					$this->pos += 4;
				} else if ($c >= 248) {
					$this->pos += 3;
				} else if ($c >= 240) {
					$this->pos += 2;
				} else if ($c >= 224) {
					$this->pos++;
				}
			} else if ($c === 0) {
				throw Exception::thrown("Unclosed string");
			}
		}
		if ($buf === null) {
			return \substr($this->str, $start, $this->pos - $start - 1);
		} else {
			return ($buf . \substr($this->str, $start, $this->pos - $start - 1));
		}
	}
}

Boot::registerClass(JsonParser::class, 'haxe.format.JsonParser');
