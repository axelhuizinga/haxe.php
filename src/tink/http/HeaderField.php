<?php
/**
 * Generated by Haxe 4.1.4
 */

namespace tink\http;

use \php\_Boot\HxAnon;
use \tink\core\NamedWith;
use \php\Boot;
use \php\_Boot\HxString;
use \tink\http\_Header\HeaderValue_Impl_;

class HeaderField extends NamedWith {
	/**
	 * @param string $s
	 * 
	 * @return HeaderField
	 */
	public static function ofString ($s) {
		$_g = HxString::indexOf($s, ":");
		if ($_g === -1) {
			return new HeaderField(\mb_strtolower($s), null);
		} else {
			$tmp = \mb_strtolower(\mb_substr($s, 0, $_g));
			return new HeaderField($tmp, \trim(\mb_substr($s, $_g + 1, null)));
		}
	}

	/**
	 * Constructs a Set-Cookie header. Please note that cookies are HttpOnly by default.
	 * You can opt out of that behavior by setting `options.scriptable` to true.
	 * 
	 * @param string $key
	 * @param string $value
	 * @param object $options
	 * 
	 * @return HeaderField
	 */
	public static function setCookie ($key, $value, $options = null) {
		if ($options === null) {
			$options = new HxAnon();
		}
		$buf = new \StringBuf();
		$buf->add((\rawurlencode($key)??'null') . "=" . (\rawurlencode($value)??'null'));
		if ($options->expires !== null) {
			$value = HeaderValue_Impl_::ofDate($options->expires);
			if ($value !== null) {
				$buf->add("; ");
				$buf->add("expires=");
				$buf->add($value);
			}
		}
		$value = $options->domain;
		if ($value !== null) {
			$buf->add("; ");
			$buf->add("domain=");
			$buf->add($value);
		}
		$value = $options->path;
		if ($value !== null) {
			$buf->add("; ");
			$buf->add("path=");
			$buf->add($value);
		}
		if ($options->secure) {
			$buf->add("; ");
			$buf->add("secure");
			$buf->add("");
		}
		if ($options->scriptable !== true) {
			$buf->add("; ");
			$buf->add("HttpOnly");
			$buf->add("");
		}
		return new HeaderField("set-cookie", $buf->b);
	}

	/**
	 * @param string $name
	 * @param string $value
	 * 
	 * @return void
	 */
	public function __construct ($name, $value) {
		parent::__construct($name, $value);
	}

	/**
	 * @return string
	 */
	public function toString () {
		if ($this->value === null) {
			return $this->name;
		} else {
			return "" . ($this->name??'null') . ": " . ($this->value??'null');
		}
	}

	public function __toString() {
		return $this->toString();
	}
}

Boot::registerClass(HeaderField::class, 'tink.http.HeaderField');
