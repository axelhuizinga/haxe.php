<?php
/**
 * Generated by Haxe 4.1.4
 */

namespace datetime\utils;

use \php\Boot;
use \datetime\data\TimezoneData;
use \datetime\_DateTime\DateTime_Impl_;
use \php\_Boot\HxString;

/**
 * Various utilities for timezones
 *
 */
class TimezoneUtils {
	/**
	 * Format date/time with timezone shift
	 *
	 * 
	 * @param TimezoneData $tz
	 * @param float $utc
	 * @param string $format
	 * 
	 * @return string
	 */
	public static function format ($tz, $utc, $format) {
		$prevPos = 0;
		$pos = HxString::indexOf($format, "%");
		$str = "";
		$period = $tz->getPeriodForUtc($utc);
		$dt = $utc - 62135596800.0 + $period->offset + 62135596800.0;
		$hh = (int)(($period->offset / 3600));
		$mm = (int)((($period->offset - $hh * 3600) / 60));
		$neg = $hh < 0;
		if ($neg) {
			$hh = -$hh;
			$mm = -$mm;
		}
		while ($pos >= 0) {
			$str = ($str??'null') . (HxString::substring($format, $prevPos, $pos)??'null');
			++$pos;
			$__hx__switch = (\StringTools::fastCodeAt($format, $pos));
			if ($__hx__switch === 90) {
				$str = ($str??'null') . ($period->abr??'null');
			} else if ($__hx__switch === 113) {
				$str = ($str??'null') . "%FT%T" . ((($neg ? "-" : "+"))??'null') . (((($hh < 10 ? "0" . ($hh??'null') : "" . ($hh??'null')))??'null') . ":" . ((($mm < 10 ? "0" . ($mm??'null') : "" . ($mm??'null')))??'null'));
			} else if ($__hx__switch === 122) {
				$str = ($str??'null') . ((($neg ? "-" : "+"))??'null') . (\StringTools::lpad("" . ($hh * 100 + $mm), "0", 4)??'null');
			} else {
				$str = ($str??'null') . "%" . ((($pos < 0 ? "" : \mb_substr($format, $pos, 1)))??'null');
			}
			$prevPos = $pos + 1;
			$pos = HxString::indexOf($format, "%", $pos + 1);
		}
		$str = ($str??'null') . (HxString::substring($format, $prevPos)??'null');
		return DateTime_Impl_::format($dt, $str);
	}
}

Boot::registerClass(TimezoneUtils::class, 'datetime.utils.TimezoneUtils');
